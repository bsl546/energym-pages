
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>energym.envs.utils.weather &#8212; energym 2020.02.19 documentation</title>
    
  <link href="../../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../../_static/css/index.f6b7ca918bee2f46fd9abac01cfb07d5.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../../../../_static/js/index.1e043a052b0af929e4d8.js">

    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">


    
    <a class="navbar-brand" href="../../../../index.html">
      <p class="title">energym</p>
    </a>
    

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    
    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/base.html">
  Buildings
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/install_min.html">
  Minimal Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/start.html">
  Getting Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/Examples.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/install_full.html">
  Full Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/add_model.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../sources/apiref.html">
  API Reference
 </a>
</li>

        
      </ul>

      <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    
</nav>


              
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for energym.envs.utils.weather</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">default_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Dry Bulb Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;Direct Normal Radiation&quot;</span><span class="p">]</span>
<span class="n">translate_dictionary_Eplus</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Dry Bulb Temperature Prediction&quot;</span><span class="p">:</span> <span class="s2">&quot;Ext_T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Direct Normal Radiation Prediction&quot;</span><span class="p">:</span> <span class="s2">&quot;Ext_Irr&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">translate_dictionary_Mod</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Dry Bulb Temperature Prediction&quot;</span><span class="p">:</span> <span class="s2">&quot;TOut.T&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Direct Normal Radiation Prediction&quot;</span><span class="p">:</span> <span class="s2">&quot;sunRad.y&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Weather"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.Weather">[docs]</a><span class="k">class</span> <span class="nc">Weather</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for handling weather files.</span>

<span class="sd">    The encapsulated weather file can be used for forecast generation.</span>
<span class="sd">    The logic is taken from https://github.com/building-energy/epw.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    headers : dict</span>
<span class="sd">        A dictionary containing the header rows of the weather file.</span>
<span class="sd">    dataframe : pd.Dataframe</span>
<span class="sd">        Stores the weather data.</span>
<span class="sd">    names : list of str</span>
<span class="sd">        List of observed weather indicators.</span>
<span class="sd">    delimiter : str</span>
<span class="sd">        Separation character in the file.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    read(fp)</span>
<span class="sd">        Reads a weather file.</span>
<span class="sd">    close()</span>
<span class="sd">        Closes the data of the current weather file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names : list of str</span>
<span class="sd">            List of observed weather indicators.</span>
<span class="sd">        delimiter : str</span>
<span class="sd">            Separation character in the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span>

<div class="viewcode-block" id="Weather.read"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.Weather.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fp</span><span class="p">,</span>
            <span class="n">generate_forecasts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">generate_forecast_method</span><span class="o">=</span><span class="s2">&quot;perfect&quot;</span><span class="p">,</span>
            <span class="n">generate_forecast_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a weather file. Generates associated forecasts if asked</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>
<span class="sd">        generate_forecasts: bool, optional</span>
<span class="sd">            If True, generate forecasts dataframe</span>
<span class="sd">        generate_forecast_method: {&#39;stochastic&#39;, &#39;perfect&#39;, &#39;persistence&#39;}, optional</span>
<span class="sd">            If &#39;stochastic&#39;, generate random forecast, If &#39;perfect&#39;, use actual weather as forecast.</span>
<span class="sd">            If &#39;persistence&#39;, persitence forecast from previous day</span>
<span class="sd">        generate_forecast_keys: list, optional</span>
<span class="sd">            List of keys to generate forecast for. By default is [&quot;Dry Bulb Temperature&quot;, &quot;Global Horizontal Radiation&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_headers</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_data</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">generate_forecast_keys</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">generate_forecast_keys</span> <span class="o">=</span> <span class="n">default_keys</span>
        <span class="k">if</span> <span class="n">generate_forecasts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_prediction_df</span><span class="p">(</span>
                <span class="n">generate_forecast_keys</span><span class="p">,</span> <span class="n">generate_forecast_method</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forecast_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">generate_forecast_keys</span>
            <span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_read_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the headers of a weather file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : dict</span>
<span class="sd">            A dictionary containing the header rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvreader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span>
                <span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csvreader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the climate data of a weather file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        df : pd.DataFrame</span>
<span class="sd">            A DataFrame containing the climate data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_row_with_climate_data</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">csvfile</span><span class="p">,</span>
                <span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span>
                <span class="n">skiprows</span><span class="o">=</span><span class="n">first_row</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">,</span>
                <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_first_row_with_climate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds the first row with the climate data of a weather file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        i : int</span>
<span class="sd">            The row number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
            <span class="n">csvreader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span>
                <span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csvreader</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">_get_extrema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">extr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">extr</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="n">extr</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">extr</span>

    <span class="k">def</span> <span class="nf">_generate_prediction_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extrema</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">last_ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">last_rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
        <span class="n">new_ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]):</span>
                <span class="n">new_ind</span> <span class="o">=</span> <span class="n">ind</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">]):</span>
                <span class="n">new_ind</span> <span class="o">=</span> <span class="n">ind</span>
            <span class="k">if</span> <span class="n">last_ind</span> <span class="o">!=</span> <span class="n">new_ind</span><span class="p">:</span>
                <span class="n">new_rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">new_ind</span> <span class="o">-</span> <span class="n">last_ind</span>
                <span class="k">for</span> <span class="n">interm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_ind</span><span class="p">,</span> <span class="n">new_ind</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interm</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">][</span>
                                                                 <span class="n">interm</span>
                                                             <span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                                                                     <span class="p">(</span><span class="n">new_ind</span> <span class="o">-</span> <span class="n">interm</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">last_rate</span>
                                                                     <span class="o">+</span> <span class="p">(</span><span class="n">interm</span> <span class="o">-</span> <span class="n">last_ind</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">new_rate</span>
                                                             <span class="p">)</span>
                <span class="n">last_ind</span> <span class="o">=</span> <span class="n">new_ind</span>
        <span class="n">new_ind</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_ind</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">,)]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">new_ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">new_rate</span>
        <span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">new_ind</span> <span class="o">-</span> <span class="n">last_ind</span>
        <span class="k">for</span> <span class="n">interm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_ind</span><span class="p">,</span> <span class="n">new_ind</span><span class="p">):</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">interm</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">,)]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">interm</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">new_ind</span> <span class="o">-</span> <span class="n">interm</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">last_rate</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">interm</span> <span class="o">-</span> <span class="n">last_ind</span><span class="p">)</span> <span class="o">/</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">new_rate</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>

<div class="viewcode-block" id="Weather.close"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.Weather.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the data of the current weather file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<div class="viewcode-block" id="EPW"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.EPW">[docs]</a><span class="k">class</span> <span class="nc">EPW</span><span class="p">(</span><span class="n">Weather</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent an EnergyPlus weather (epw) file.</span>

<span class="sd">    Subclasses Weather and inherits its data handling functions.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    get_forecast(hour, day, month, forecast_length)</span>
<span class="sd">        Provides a weather forecast for a requested length and requested keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Year&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Month&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Hour&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Minute&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Data Source and Uncertainty Flags&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Dry Bulb Temperature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Dew Point Temperature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Relative Humidity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Atmospheric Station Pressure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Extraterrestrial Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Extraterrestrial Direct Normal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Horizontal Infrared Radiation Intensity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Global Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Direct Normal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Diffuse Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Global Horizontal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Direct Normal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Diffuse Horizontal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Zenith Luminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wind Direction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wind Speed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Total Sky Cover&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Opaque Sky Cover (used if Horizontal IR Intensity missing)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Visibility&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ceiling Height&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Present Weather Observation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Present Weather Codes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Precipitable Water&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Aerosol Optical Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Snow Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Days Since Last Snowfall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Albedo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Liquid Precipitation Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Liquid Precipitation Quantity&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_prediction_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keylist</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;stochastic&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_prediction_sequence</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">])</span>
            <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;perfect&quot;</span><span class="p">:</span>
            <span class="n">pred_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span>
                <span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Hour&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">keylist</span>
                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pred_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">},</span>
                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;persistence&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;persistence forecast not yet implmented&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method </span><span class="si">{}</span><span class="s2"> not defined for generating forecast&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">method</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_df</span>

<div class="viewcode-block" id="EPW.get_forecast"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.EPW.get_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">get_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">forecast_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides a weather forecast for a requested length and requested keys.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        hour : int</span>
<span class="sd">            Current hour.</span>
<span class="sd">        day : int</span>
<span class="sd">            Current day.</span>
<span class="sd">        month : int</span>
<span class="sd">            Current month.</span>
<span class="sd">        forecast_length : int</span>
<span class="sd">            Number of forecasted hours.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecast : dict</span>
<span class="sd">            Containing a forecast of the requested length for the requested keys.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If no weather file has been loaded.</span>
<span class="sd">        Exception</span>
<span class="sd">            If the weather file has a non-standard format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">change_ind</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">hour</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">change_ind</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No weather file&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date_bool_array</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">month</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">[</span><span class="s2">&quot;Day&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">day</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">[</span><span class="s2">&quot;Hour&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">hour</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrong weather file format. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">prediction_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_keys</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">date_bool_array</span><span class="p">)</span> <span class="k">if</span> <span class="n">val</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">change_ind</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">day</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="n">forecast_length</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">rest</span> <span class="o">=</span> <span class="n">forecast_length</span> <span class="o">-</span> <span class="n">length</span> <span class="o">+</span> <span class="n">index</span>
            <span class="n">day_slice</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">length</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">rest</span><span class="p">],</span>
                <span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">day_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
                        <span class="n">index</span><span class="p">:</span> <span class="n">index</span> <span class="o">+</span> <span class="n">forecast_length</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">del_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">day_slice</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prediction_keys</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">del_keys</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">day_slice</span><span class="p">:</span>
            <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># Carry out translation to standard name so as to have same naming as FMU outputs</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">day_slice</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">translate_dictionary_Eplus</span><span class="p">):</span>
                <span class="n">forecast</span><span class="p">[</span><span class="n">translate_dictionary_Eplus</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">forecast</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">forecast</span></div></div>


<div class="viewcode-block" id="MOS"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.MOS">[docs]</a><span class="k">class</span> <span class="nc">MOS</span><span class="p">(</span><span class="n">Weather</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class to represent a Modelica weather (mos) file.</span>

<span class="sd">    Subclasses Weather and inherits its data handling functions.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    get_forecast(time, forecast_length)</span>
<span class="sd">        Provides a weather forecast for a requested length and requested keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Dry Bulb Temperature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Dew Point Temperature&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Relative Humidity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Atmospheric Station Pressure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Extraterrestrial Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Extraterrestrial Direct Normal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Horizontal Infrared Radiation Intensity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Global Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Direct Normal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Diffuse Horizontal Radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Global Horizontal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Direct Normal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Diffuse Horizontal Illuminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Zenith Luminance&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wind Direction&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Wind Speed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Total Sky Cover&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Opaque Sky Cover (used if Horizontal IR Intensity missing)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Visibility&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ceiling Height&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Present Weather Observation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Present Weather Codes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Precipitable Water&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Aerosol Optical Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Snow Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Days Since Last Snowfall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Albedo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Liquid Precipitation Depth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Liquid Precipitation Quantity&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the headers of a MOS weather file. Overrides parent method because headers are different from rest</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d1 : dict</span>
<span class="sd">            A dictionary containing the header rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_read_headers</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d0</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>
                <span class="n">list_k</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="n">d1</span><span class="p">[</span><span class="n">list_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">list_k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">d1</span>

<div class="viewcode-block" id="MOS.read"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.MOS.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fp</span><span class="p">,</span>
            <span class="n">generate_forecasts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">generate_forecast_method</span><span class="o">=</span><span class="s2">&quot;perfect&quot;</span><span class="p">,</span>
            <span class="n">generate_forecast_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a weather file from MOS.</span>

<span class="sd">        Overrides the read method of Weather.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        fp : str</span>
<span class="sd">            The path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">fp</span><span class="p">,</span>
            <span class="n">generate_forecasts</span><span class="p">,</span>
            <span class="n">generate_forecast_method</span><span class="p">,</span>
            <span class="n">generate_forecast_keys</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_get_prediction_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keylist</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;stochastic&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_prediction_sequence</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span><span class="p">])</span>
            <span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;perfect&quot;</span><span class="p">:</span>
            <span class="n">pred_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataframe</span><span class="p">[[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">keylist</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">pred_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot; Prediction&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keylist</span><span class="p">},</span>
                <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;persistence&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;persistence forecast not yet implemented&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Method </span><span class="si">{}</span><span class="s2"> not defined for generating forecast&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">method</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_df</span>

<div class="viewcode-block" id="MOS.get_forecast"><a class="viewcode-back" href="../../../../sources/apiref.html#energym.envs.utils.weather.MOS.get_forecast">[docs]</a>    <span class="k">def</span> <span class="nf">get_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">forecast_length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a forecast for the next forecast_length hours.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        time : int</span>
<span class="sd">            Start time of forecast</span>
<span class="sd">        forecast_length : int</span>
<span class="sd">            Forecast length in hours</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecast : dict</span>
<span class="sd">            Containing a forecast of the requested length for the requested keys.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception</span>
<span class="sd">            If no weather file has been loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No weather file&quot;</span><span class="p">)</span>
        <span class="n">prediction_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_keys</span>

        <span class="k">if</span> <span class="n">time</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Start of forecast is not in weather file index. using closest time&quot;</span>
            <span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="n">day_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                   <span class="n">time</span><span class="p">:</span> <span class="n">time</span> <span class="o">+</span> <span class="mi">3600</span> <span class="o">*</span> <span class="p">(</span><span class="n">forecast_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">prediction_keys</span>
                   <span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

        <span class="c1"># Carry out translation to standard name so as to have same naming as FMU outputs</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">day_slice</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">translate_dictionary_Mod</span><span class="p">):</span>
                <span class="n">forecast</span><span class="p">[</span><span class="n">translate_dictionary_Mod</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">forecast</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">day_slice</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;.T&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">forecast</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">+</span> <span class="mf">273.15</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">forecast</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">forecast</span></div></div>
</pre></div>

              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../../../../_static/js/index.1e043a052b0af929e4d8.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020, psh, bsl, tgi.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>